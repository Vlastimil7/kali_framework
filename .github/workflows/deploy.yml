script: |
  cd /var/www/web.kalasekvyvoj.cz/web/kali-framework
  
  echo "ğŸš€ Starting deployment..."
  
  # Backup critical files BEFORE anything
  echo "ğŸ’¾ Backing up critical files..."
  cp .env /tmp/deploy-env-backup 2>/dev/null || true
  cp public/.htaccess /tmp/deploy-htaccess-backup 2>/dev/null || true
  
  # FORCE sync - ignore all local changes
  echo "ğŸ“¥ Force syncing with GitHub..."
  git fetch origin
  git reset --hard origin/main
  git clean -fd
  
  # Restore critical files
  echo "ğŸ”„ Restoring critical files..."
  cp /tmp/deploy-env-backup .env 2>/dev/null || true
  cp /tmp/deploy-htaccess-backup public/.htaccess 2>/dev/null || true
  chmod 600 .env
  
  # Install dependencies
  echo "ğŸ“¦ Installing PHP dependencies..."
  composer install --no-dev --optimize-autoloader --no-interaction
  
  echo "ğŸ“¦ Installing Node dependencies..."
  npm ci --production
  
  echo "ğŸ—ï¸ Building assets..."
  npm run build
  
  # Set permissions
  echo "ğŸ”§ Setting permissions..."
  sudo chown -R deploy:www-data .
  sudo chmod -R 755 .
  sudo chmod -R 775 storage/
  sudo chmod 600 .env
  
  # Clear cache
  echo "ğŸ§¹ Clearing cache..."
  rm -rf storage/cache/*
  rm -rf storage/logs/*.log
  
  # Reload services
  echo "ğŸ”„ Reloading Apache..."
  sudo systemctl reload php8.2-fpm apache2
  
  echo "âœ… Deployment completed successfully!"